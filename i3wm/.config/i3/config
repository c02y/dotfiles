# This file has been auto-generated by i3-config-wizard(1).
# It will not be overwritten, so edit it as you like.
#
# Should you change your keyboard layout some time, delete
# this file and re-run i3-config-wizard(1).
#

# i3 config file (v4)
#
# Please see https://i3wm.org/docs/userguide.html for a complete reference!

# Mod4 = L_Super
set $mod Mod4

# Font for window titles. Will also be used by the bar unless a different font
# is used in the bar {} block below.
font pango:DejaVu Sans Mono 12

title_align center
# TODO: this feature will be v4.20
# enable window icons for all windows
# for_window [class=".*"] title_window_icon on

# NOTE: limitations in doc
default_border pixel 3
default_floating_border pixel 8
hide_edge_borders smart

workspace_auto_back_and_forth yes

# toggle log for debug
# TODO: where is the log file
# bindsym $mod+Shift+l debuglog toggle

# This font is widely installed, provides lots of unicode glyphs, right-to-left
# text rendering and scalability on retina/hidpi displays (thanks to pango).
#font pango:DejaVu Sans Mono 8

# The combination of xss-lock, nm-applet and pactl is a popular choice, so
# they are included here as an example. Modify as you see fit.

# xss-lock grabs a logind suspend inhibit lock and will use i3lock to lock the
# screen before suspend. Use loginctl lock-session to lock your screen.
exec --no-startup-id xss-lock --transfer-sleep-lock -- i3lock --nofork

# NetworkManager is the most popular way to manage wireless networks on Linux,
# and nm-applet is a desktop environment-independent system tray GUI for it.
exec_always --no-startup-id nm-applet

# Use pactl to adjust volume in PulseAudio.
set $refresh_i3status killall -SIGUSR1 i3status
bindsym $mod+Home exec --no-startup-id \
		pactl set-sink-volume @DEFAULT_SINK@ +10% && $refresh_i3status
bindsym $mod+End exec --no-startup-id \
		pactl set-sink-volume @DEFAULT_SINK@ -10% && $refresh_i3status
bindsym $mod+Pause exec --no-startup-id \
		pactl set-sink-mute @DEFAULT_SINK@ toggle && $refresh_i3status
bindsym XF86AudioMicMute exec --no-startup-id \
		pactl set-source-mute @DEFAULT_SOURCE@ toggle && $refresh_i3status

# Use Mouse+floating_modifier to drag floating windows to their wanted position
# floating_modifier $mod
# Mod1 = Alt
floating_modifier Mod1
floating_maximum_size 1920 x 1080

# start a terminal
# bindsym $mod+Return exec i3-sensible-terminal

# kill focused window
bindsym $mod+Mod1+x kill
bindsym --whole-window $mod+Mod1+button1 kill

# change focus
# NOTE: Use rofi to get all windows in all workspaces
# repeating prev/next works only inside container when the container is front/rear
# prev/next won't work for a container with only one window,
# need to turn container status off first or use $mod+arrow to change focus
bindsym Mod1+Tab focus next
bindsym Mod1+Shift+Tab focus prev
# alternatively, you can use the cursor keys:
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# move focused window
# this can also be used to move window into container
# NOTE: a container containing only one window can turn its container status off with toggle floating
# move left/right can also be used to turn the one window container status off
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Right move right
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
# split in horizontal orientation
bindsym $mod+backslash split h
# split in vertical orientation
bindsym $mod+equal split v

# NOTE: fullscreen and center commands only work for floating windows
bindsym F11 fullscreen toggle
# NOTE: Don't use 'move absolute position center", it doesn't work expected in multiple monitors
bindsym $mod+y move position center

# change container layout (stacked, tabbed, toggle split)
# tabbed ~ maximized current window, and unable to maximized floating window, use fullscreen
# NOTE: two layout commands only work for current container
bindsym $mod+w layout toggle tabbed split
bindsym $mod+Shift+w layout toggle split

# toggle tiling / floating
bindsym $mod+Return floating toggle
# button1=left, button2=middle, button3=right
bindsym --whole-window $mod+Shift+button3 floating toggle
bindsym --whole-window $mod+Shift+button1 fullscreen toggle

# change focus between tiling / floating windows
bindsym $mod+Shift+Return focus mode_toggle

# focus the parent container
# bindsym $mod+a focus parent
# focus the child container
#bindsym $mod+d focus child

# Define names for default workspaces for which we configure key bindings later on.
# We use variables to avoid repeating the names in multiple places.
# icons are copied from FontAwesome v5 cheatsheet
# https://fontawesome.com/v5/cheatsheet
set $ws1 "1:"
set $ws2 "2:"
set $ws3 "3:"
# set $ws4 "4"
# set $ws5 "5"
# set $ws6 "6"
# set $ws7 "7"
# set $ws8 "8"
# set $ws9 "9"
# set $ws10 "10"

# switch to workspace
bindsym $mod+1 workspace $ws1
bindsym $mod+2 workspace $ws2
bindsym $mod+3 workspace $ws3
# bindsym $mod+4 workspace number $ws4
# bindsym $mod+5 workspace number $ws5
# bindsym $mod+6 workspace number $ws6
# bindsym $mod+7 workspace number $ws7
# bindsym $mod+8 workspace number $ws8
# bindsym $mod+9 workspace number $ws9
# bindsym $mod+0 workspace number $ws10

# move focused container to workspace
bindsym $mod+Shift+1 move container to workspace number $ws1; workspace number $ws1
bindsym $mod+Shift+2 move container to workspace number $ws2; workspace number $ws1
bindsym $mod+Shift+3 move container to workspace number $ws3; workspace number $ws1
# bindsym $mod+Shift+4 move container to workspace number $ws4
# bindsym $mod+Shift+5 move container to workspace number $ws5
# bindsym $mod+Shift+6 move container to workspace number $ws6
# bindsym $mod+Shift+7 move container to workspace number $ws7
# bindsym $mod+Shift+8 move container to workspace number $ws8
# bindsym $mod+Shift+9 move container to workspace number $ws9
# bindsym $mod+Shift+0 move container to workspace number $ws10

bindsym $mod+z workspace prev
bindsym $mod+x workspace back_and_forth
bindsym $mod+Shift+z move container to workspace prev; workspace prev
bindsym $mod+Shift+x move container to workspace back_and_forth; workspace back_and_forth

# reload the configuration file
bindsym $mod+Shift+q reload
# restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
# NOTE: reload will not run exec-always, +Alt+ will not work, use Mod1 instead
# reload i3status.conf need restart i3
# exec is only run by initial i3, exec_always can be executed by restart
bindsym $mod+Mod1+q restart
# exit i3 (logs you out of your X session, need confirmation)
bindsym $mod+Ctrl+q exec "i3-nagbar -t warning -m \
'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' \
-B 'Yes, exit i3' 'i3-msg exit'"

# resize window (you can also use the mouse for that)
mode "resize" {
	# These bindings trigger as soon as you enter the resize mode
	bindsym Left resize shrink width 10 px or 10 ppt
	bindsym Down resize grow height 10 px or 10 ppt
	bindsym Up resize shrink height 10 px or 10 ppt
	bindsym Right resize grow width 10 px or 10 ppt

	# back to normal: Enter or Escape or $mod+r
	bindsym Escape mode "default"
}
# NOTE: shortcuts in it are hard to use
bindsym $mod+Shift+r mode "resize"

# swap windows using mouse
# $mod+LeftKey to mark the window ->
# $mod+RighKey to swap the window with the marked window
bindsym --whole-window $mod+button1 mark --add "swapee"
bindsym --whole-window $mod+button3 swap container with mark "swapee"; [con_mark="swapee"] focus; unmark "swapee"
# swap windows using key
mode "swap" {
	# before this, already mark the current window
	# use arrow to change focus -> swap the marked with the focused ->
	# unmark the marked one -> back to default -> changed the focus back to the marked one
	bindsym Left focus left; swap container with mark "swapee"; unmark "swapee"; mode "default"; focus left
	bindsym Down focus down; swap container with mark "swapee"; unmark "swapee"; mode "default"; focus down
	bindsym Up focus up; swap container with mark "swapee"; unmark "swapee"; mode "default"; focus up
	bindsym Right focus right; swap container with mark "swapee"; unmark "swapee"; mode "default"; focus right

	bindsym Escape unmark "swappee"; mode "default";
}
bindsym $mod+Shift+s mark --add "swapee"; mode "swap"

# mark window and goto the marked window
# read 1 character and mark the current window with this character
bindsym $mod+m exec i3-input -F 'mark %s' -l 1 -P 'Mark: '
# read 1 character and go to the window with the character
bindsym $mod+Shift+m exec i3-input -F '[con_mark="%s"] focus' -l 1 -P 'Goto: '

# NOTE: sticky makes it visible in all workspaces
# only work for floating window, floating window is already on top
bindsym $mod+F12 sticky toggle

# force floating for all new windows by default
# so assign specific windows to floating seems unnecessary
# for_window [class="[.]*"] floating enable
# WM_NAME=title, WM_WINDOW_ROLE=window_role
# NOTE: USE , instead of ; for for_window
for_window [floating] resize set 70 ppt 80 ppt, move position center
for_window [class="copyq"] floating enable
for_window [class="Vivaldi-stable" window_role="pop-up"] floating enable
for_window [class="fcitx5-config-qt"] floating enable
for_window [class="Alacritty"] floating enable
# NOTE: need dropdown terminal to float when used with tdrop because of the flicker issue:
# https://github.com/noctuid/tdrop/issues/1#issuecomment-102650457
for_window [class="Dropdown"] floating enable
for_window [class="Fsearch"] floating enable
for_window [class="flameshot"] floating enable
for_window [class="mpv"] floating enable
for_window [class="Plank"] floating enable
for_window [class="Blueman-manager"] floating enable
for_window [class="Pavucontrol"] floating enable

# Move the followings windows into specific workspace
assign [class="Anki"] $ws2
assign [class="VirtualBox Machine"] $ws2

# disable the following windows (notifications) from stealing focus
no_focus [class="TelegramDesktop"]

# Bindings for the following applications
# use `xmodmap -pke` to get bindcode value
bindsym $mod+e exec tdrop -t -m -w 100% -h 100% emacsclient -c
bindsym $mod+f exec jumpapp -m firefox
bindsym $mod+s exec jumpapp -m fsearch
bindsym $mod+b exec jumpapp -m calibre
bindsym $mod+v exec jumpapp -m vivaldi-stable
bindsym $mod+a workspace number $ws3; exec jumpapp -m audacious
bindsym $mod+p exec jumpapp -m qpdfview
# NOTE: the -t for jumpapp and -t for alacritty must be the same
bindsym $mod+r exec jumpapp -m -t RangerFM alacritty -t RangerFM -e ranger
bindsym $mod+h exec jumpapp -m -t Btop alacritty -t Btop -e btop
bindsym $mod+t exec jumpapp -m -t Alacritty alacritty -t Alacritty
bindsym $mod+Shift+c exec jumpapp -m clion
bindsym $mod+Shift+t exec jumpapp -m telegram-desktop
bindsym $mod+Print exec flameshot gui
bindsym $mod+Shift+Print exec flameshot launcher
bindsym $mod+Shift+Pause exec ~/.connect_speaker.sh
# NOTE: the options for tdrop are important, especially for WM and multiple monitors
# -y 30 = Height in bar config, to avoid overlapping the top bar
bindsym F12 exec tdrop -t -m -y $bar_height -w 100% -h 98% kitty --class=Dropdown --title=Dropdown_Kitty
# NOTE: 133 is Super_L, bindsym+Mod4 doesn't work
# If using
# bindcode --release 133 exec "rofi -fixed-num-lines -show-icons -combi-modi window,drun,ssh -show combi \
bindsym $mod+q exec "rofi -fixed-num-lines -show-icons -combi-modi window,drun,ssh -show combi \
			              -modi combi,window,drun,run,ssh,power:rofi-power-menu \
						  -matching regex -drun-match-fields all -terminal kitty \
						  -theme /usr/share/rofi/themes/solarized_alternate.rasi \
						  -display-combi ALL -display-drun APP -display-window WINDOW \
						  -display-run BIN -display-ssh SSH -font 'DejaVu Sans Mono 14'"

# Autostart applications
# NOTE: the --experimental-backend for picom is to fix the screen tearing issue
# https://youtu.be/MfL_JkcEFbE, https://www.reddit.com/r/archlinux/comments/j58isj/
exec_always --no-startup-id picom --experimental-backend --config ~/.config/i3/picom.conf
exec_always --no-startup-id nitrogen --set-scaled ~/.config/i3/mountains-1412683.jpg
# NOTE: nm-applet and blueman-applet sometimes exit somehow
exec_always --no-startup-id blueman-applet
exec --no-startup-id copyq
exec --no-startup-id fcitx5 -d
# NOTE: for multiple monitors: (DP-0 is the primary, DP-2 is the secondary)
# exec --no-startup-id xrandr --output DP-0 --auto --output DP-2 --auto --right-of DP-0
exec --no-startup-id xrandr --output DP-0 --auto --output DP-2 --off
# for blank screen and sleep/hibernate
exec --no-startup-id xfce4-power-manager

# configure colors using https://thomashunter.name/i3-configurator/
# There is a black in between the window bar and i3bar, use black color to hide it
# https://github.com/i3/i3/discussions/4601
set $bgc_hi #000000
set $txt_hi #2e9ef4
set $bgc_ia #1B1C1F
set $txt_ia #888888
set $bgc_ug #900000

# Colors for window bar
# TODO: Don't know what indicator/child_border/placeholder are all about
# NOTE: child_border is the border of floating window/split container
# class                 border  backgr. text    indicator child_border
client.focused          $bgc_hi $bgc_hi $txt_hi $bgc_ug   $txt_hi
client.focused_inactive $bgc_hi $bgc_hi $txt_ia $txt_hi   $bgc_ia
client.unfocused        $bgc_hi $bgc_ia $txt_ia $txt_hi   $bgc_hi
client.urgent           #bgc_ug $bgc_ia $txt_ia $bgc_ug   $bgc_ug
client.placeholder      $bgc_hi $bgc_hi $fgc_wh $bgc_ug   $bgc_ia
client.background       $bgc_hi # TODO: ?

set $bar_height 26

# Start i3bar to display a workspace bar (plus the system information i3status
# finds out, if available)
bar {
	i3bar_command i3bar
	status_command i3status-rs ~/.config/i3/i3status-rust.toml
	position top
	# NOTE: bar_height and the font size must be set very carefully
	# so the separator on the i3status-rust will be rendered well
	# pairs: 25+13.2, 27+13.7, 26+13.15
	font pango:DejaVu Sans Mono, Font Awesome 5 Free 13.15
	Height $bar_height
	workspace_min_width 40
	tray_padding 2
	# show only workspace name parts without the numbers
	strip_workspace_numbers yes

	# Colors for workspace names/labels
	colors {
		separator $bgc_hi
		background $bgc_hi
		statusline $txt_hi
		# <colorclass> <border> <background> <text>
		focused_workspace  $bgc_hi $bgc_hi $txt_hi
		active_workspace   $bgc_hi $bgc_hi $bgc_ug
		inactive_workspace $bgc_hi $bgc_hi $txt_ia
		urgent_workspace   $bgc_ug $bgc_ug $txt_ia
	}
}
